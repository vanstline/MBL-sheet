<!DOCTYPE html>
<html>
  <head lang="zh">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="renderer" content="webkit" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1,user-scalable=0" />
    <title>MBLsheet</title>

    <link rel="stylesheet" href="./plugins/css/pluginsCss.css" />
    <link rel="stylesheet" href="./plugins/plugins.css" />
    <link rel="stylesheet" href="./css/MBLsheet.css" />
    <link rel="stylesheet" href="./assets/iconfont/iconfont.css" />
    <script src="./plugins/js/plugin.js"></script>

    <!-- rollup MBLsheet.js -->
    <script src="./MBLsheet.umd.js"></script>
  </head>

  <body>
    <!-- Non-full screen test -->
    <div style="margin: 80px auto; padding: 0px; width: 970px">
      <div>
        行数：<input type="text" id="row" value="100" /><button
          id="setRow"
          onclick="MBLsheet.setLength($('#row').val())">
          设置
        </button>
      </div>
      <div style="position: relative; width: 970px; height: 500px">
        <div id="mblsheet" style="width: 970px; height: 500px"></div>

        <!-- <div style="margin: 30px auto; display: flex; justify-content: center">
        <canvas
          id="ctx"
          width="300"
          height="300"
          style="border: 1px solid #000" />
      </div> -->
      </div>
      <div>
        <input
          type="button"
          value="获取数据"
          onclick="console.log(MBLsheet.getData())" />
        <input
          type="button"
          value="获取数据，并校验"
          onclick="console.log(MBLsheet.getData(true))" />
      </div>
    </div>

    <!-- full screen test -->
    <!-- <div
      id="MBLsheet"
      style="
        margin: 0px;
        padding: 0px;
        position: absolute;
        width: 100%;
        height: 100%;
        left: 0px;
        top: 0px;
      "></div> -->
    <!-- demo feature, non-production use -->
    <script src="./demoData/demoFeature.js"></script>

    <script src="./demoData/sheetFormula.js"></script>
    <script src="./demoData/sheetCell.js"></script>
    <script src="./demoData/sheetConditionFormat.js"></script>
    <script src="./demoData/sheetTable.js"></script>
    <script src="./demoData/sheetComment.js"></script>
    <script src="./demoData/sheetPivotTableData.js"></script>
    <script src="./demoData/sheetPivotTable.js"></script>
    <script src="./demoData/sheetSparkline.js"></script>
    <script src="./demoData/sheetChart.js"></script>
    <script src="./demoData/sheetPicture.js"></script>
    <script src="./demoData/sheetDataVerification.js"></script>

    <script src="./demoData/demoSg.js"></script>

    <script>
      const excelDataSource = [
        {
          createDate: "2024-03-25 19:44:36.0",
          cxPrimerCartId: 1731287,
          cxPrimerCartInfo: [
            {
              baseNumber: 0,
              concentration: "",
              createDate: "2024-03-25 19:44:36.0",
              cxPrimerCode: "U1011200",
              cxPrimerId: 2250,
              endDate: null,
              id: 1731287,
              ids: null,
              isOldPrimer: 1,
              mark: null,
              name: "ITS3",
              page: 1,
              primerTypeIds: null,
              reverseSequence: "",
              rows: 20,
              sequence: "GCATCGATGAAGAACGCAGC",
              startDate: null,
              status: 0,
              targetLength: 0,
              type: 1,
              typeName: "通用",
              updateMark: null,
              userId: 375760,
              userInfo: null,
            },
          ],
          cxPrimerCartList: [],
          cxSampleCartId: 8684104,
          cxSampleCartInfo: [
            {
              carrierId: 0,
              carrierName: "1212",
              createDate: "2024-03-25 19:44:36.0",
              cxSampleCode: "31224032500002",
              cxSampleId: 32208228,
              endDate: null,
              id: 8684104,
              ids: null,
              isOldSample: 1,
              mark: null,
              maxFragmentLength: "23",
              minFragmentLength: "12",
              name: "qwer",
              note: "",
              page: 1,
              resistance: "12",
              rows: 20,
              sampleSequence: "",
              sampleTypeId: 1,
              sampleTypeIds: null,
              sampleTypeName: "PCR产物(已纯化)",
              startDate: null,
              status: 0,
              updateMark: null,
              userId: 375760,
              userInfo: null,
            },
          ],
          endDate: null,
          id: 22955773,
          ids: null,
          mark: null,
          page: 1,
          rows: 20,
          seqMark: "噬菌体质粒",
          seqText: "单向",
          sequenceMethod: 0,
          sequenceQuest: 1,
          sort: 1,
          startDate: null,
          status: 0,
          updateMark: null,
          userId: 375760,
          userInfo: null,
        },
        {
          createDate: "2024-03-25 19:44:36.0",
          cxPrimerCartId: 1731287,
          cxPrimerCartInfo: [
            {
              baseNumber: 0,
              concentration: "",
              createDate: "2024-03-25 19:44:36.0",
              cxPrimerCode: "U1011200",
              cxPrimerId: 2250,
              endDate: null,
              id: 1731287,
              ids: null,
              isOldPrimer: 1,
              mark: null,
              name: "ITS3",
              page: 1,
              primerTypeIds: null,
              reverseSequence: "",
              rows: 20,
              sequence: "GCATCGATGAAGAACGCAGC",
              startDate: null,
              status: 0,
              targetLength: 0,
              type: 1,
              typeName: "通用",
              updateMark: null,
              userId: 375760,
              userInfo: null,
            },
          ],
          cxPrimerCartList: [],
          cxSampleCartId: 8684105,
          cxSampleCartInfo: {
            carrierId: 0,
            carrierName: "123",
            createDate: "2024-03-25 19:44:36.0",
            cxSampleCode: "31224032500001",
            cxSampleId: 32208227,
            endDate: null,
            id: 8684105,
            ids: null,
            isOldSample: 1,
            mark: null,
            maxFragmentLength: "34",
            minFragmentLength: "12",
            name: "12312312",
            note: "",
            page: 1,
            resistance: "123",
            rows: 20,
            sampleSequence: "",
            sampleTypeId: 1,
            sampleTypeIds: null,
            sampleTypeName: "菌株",
            startDate: null,
            status: 0,
            updateMark: null,
            userId: 375760,
            userInfo: null,
          },
          endDate: null,
          id: 22955774,
          ids: null,
          mark: null,
          page: 1,
          rows: 20,
          seqMark: "",
          seqText: "单向",
          sequenceMethod: 0,
          sequenceQuest: 1,
          sort: 2,
          startDate: null,
          status: 0,
          updateMark: null,
          userId: 375760,
          userInfo: null,
        },
      ];
      const columns = [
        {
          dataIndex: "sampleName",
          title: "样本名称",
          fieldsProps: {
            required: true,
            type: "text",
            range: [-1, 999999],
            verifyFn: function (text) {
              var status = false;
              var message = "";
              if (text == "1") {
                status = false;
                message = "请输入样品名称";
              } else {
                if (!/^(\w|#|\(|\)|\.|\-|\+)+$/.test(text)) {
                  status = false;
                  message =
                    "样品名称不合法（规则：A-Z、a-z、0-9、#、.、()、-、+,限制长度22个字符）";
                } else {
                  status = true;
                  message = "";
                }
              }

              console.log(
                "%c Line:270 🍢",
                "color:#ed9ec7",
                text,
                status,
                message
              );
              return {
                status,
                message,
              };
              // console.log("%c Line:458 🥃 text", "color:#93c0a4", text);
              // return {
              //   status: text === "123123",
              //   message: `当前值为${text}，不符合规则`,
              // };
            },
          },
          extra: {
            style: {
              width: 30,
              // background: "red",
            },
            onclick: (text, data, index) => {
              console.log(
                "%c Line:409 🧀 text, index   jjljl",
                "color:#7f2b82",
                text,
                data,
                index
              );
            },
          },
          render: (text, record, index) => {
            return record.cxSampleCartInfo?.name;
          },
          onchange: (text, record, i, { setRowData }) => {
            console.log(
              "%c Line:282 🍐 text, record",
              "color:#465975",
              text,
              record,
              i,
              setRowData
            );
            setRowData({
              sampleName: text,
              sampleTypeId: text,
            });
          },
        },
        {
          // dataIndex: "sampleTypeName",
          // title: "样本类型",
          // fieldsProps: {
          //   type: "select",
          //   type2: "multi",
          //   defaultValue: "PCR已纯化-Value",
          //   options: [
          //     // "PCR已纯化", "PCR未纯化", "菌株", "质粒"
          //     { label: "PCR已纯化111", value: "PCR已纯化-Value" },
          //     { label: "PCR未纯化", value: "PCR未纯化-Value" },
          //     { label: "菌株", value: "菌株-Value" },
          //     { label: "质粒", value: "质粒-Value" },
          //   ],
          // },
          // render: (text, record, index) => {
          //   return record.cxSampleCartInfo?.sampleTypeName;
          // },
          dataIndex: "sampleTypeId",
          title: "样本类型",
          fieldsProps: {
            // defaultValue: '菌株',
            type: "select",
            // type2: "multi",
            options: ["PCR已纯化", "PCR未纯化", "菌株", "质粒"],
            // options: [
            //   { label: "菌株", value: "4" },
            //   { label: "PCR产物(已纯化)", value: 1 },
            // ],
            verifyFn(text) {
              // console.log("%c Line:458 🥃 text", "color:#93c0a4", text);
              return {
                status: text !== "123123",
                message: `当前值为${text}，不符合规则`,
              };
            },
          },
          render: (text, record, index) => {
            return record?.cxSampleCartInfo?.sampleTypeId;
          },
          onchange: (text, record, i, config) => {
            // console.log(
            //   "%c Line:318 🌮 text, record, i, config",
            //   "color:#e41a6a",
            //   text,
            //   record,
            //   i,
            //   config
            // );
          },
        },
        // {
        //   dataIndex: "sampleTypeName",
        //   title: "样本类型",
        //   fieldsProps: {
        //     type: "select",
        //     options: ["PCR未纯化", "PCR已纯化", "菌株", "质粒"],
        //   },
        //   render: (text, record, index) => {
        //     return record?.cxSampleCartInfo?.sampleTypeName;
        //   },
        // },
        // {
        //   dataIndex: "resistance",
        //   title: "抗性",
        //   fieldsProps: {
        //     type: "autocomplete",
        //     type2: "multi",
        //     // type: "select",
        //     // type2: "select",
        //     options: ["Kan", "Amp"],
        //   },
        //   render: (text, record, index) => {
        //     return record.cxSampleCartInfo?.resistance;
        //   },
        // },
        // {
        //   dataIndex: "carrierName",
        //   title: "载体",
        //   render: (text, record, index) => {
        //     return record.cxSampleCartInfo?.carrierName;
        //   },
        // },
        // {
        //   dataIndex: "minFragmentLength",

        //   title: "最小长度",

        //   fieldsProps: {
        //     type: "text",

        //     compareInfo: {
        //       sign: "in", // 比较符

        //       range: [0, 999999],
        //     },
        //   },

        //   render: (text, record, index) => {
        //     return record.cxSampleCartInfo?.minFragmentLength;
        //   },
        // },

        // {
        //   dataIndex: "maxFragmentLength",

        //   title: "最大长度",

        //   fieldsProps: {
        //     type: "text",

        //     compareInfo: {
        //       sign: "in", // 比较符

        //       range: [0, 999999],
        //     },
        //   },

        //   render: (text, record, index) => {
        //     return record.cxSampleCartInfo?.maxFragmentLength;
        //   },
        // },

        // {
        //   dataIndex: "sampleConcentration",

        //   title: "样品备注",

        //   fieldsProps: {
        //     type: "select",

        //     options: [
        //       "GC Rich",
        //       "复杂结构",
        //       "重复序列",
        //       "低拷贝",
        //       "病毒DNA",
        //       "噬菌体质粒",
        //     ],
        //   },
        // },

        // {
        //   dataIndex: "sampleConcentration",

        //   title: "要求",

        //   fieldsProps: {
        //     type: "select",

        //     options: ["单向", "测通", "双向", "多向"],
        //   },

        //   render: (text, record, index) => {
        //     return record.seqText;
        //   },
        // },

        // {
        //   dataIndex: "primerTypeName",

        //   title: "引物类型",

        //   fieldsProps: {
        //     type: "select",

        //     options: ["通用", "自带", "合成", "暂存引物"],
        //   },

        //   render: (text, record, index) => {
        //     return record.cxPrimerCartInfo?.[0]?.typeName;
        //   },
        // },

        // {
        //   dataIndex: "primerName",

        //   title: "引物名称",

        //   // render: (text, record, index) => {
        //   //   return record.cxPrimerCartInfo?.[0]?.name;
        //   // },
        // },

        // {
        //   dataIndex: "options",
        //   title: "操作",
        //   fieldsProps: {
        //     // defaultValue: "菌株",

        //     verifyFn(text) {
        //       // console.log("%c Line:458 🥃 text", "color:#93c0a4", text);
        //       return {
        //         status: text === "123123",
        //         message: `当前值为${text}，不符合规则`,
        //       };
        //     },
        //   },
        //   onchange: (text, record, i, { setRowData }) => {
        //     setRowData({
        //       sampleName: text * 2,
        //       sampleTypeId: text,
        //       options: text,
        //     });
        //   },
        //   render: () => "删除",
        //   extra: {
        //     style: {
        //       width: 100,
        //       background: "red",
        //     },
        //     onclick: (text, data, index) => {
        //       console.log(
        //         "%c Line:409 🧀 text, index   jjljl",
        //         "color:#7f2b82",
        //         text,
        //         data,
        //         index
        //       );
        //       MBLsheet.deleteRow(index, 1);
        //     },
        //   },
        // },
      ];

      // setTimeout(() => {
      MBLsheet.init(
        { container: "mblsheet" },
        {
          columns: columns,
          dataSource: [],
          row: 2,
        }
      );
      // }, 2000);

      $(function () {
        setTimeout(() => {
          MBLsheet.setData(excelDataSource);
        }, 3000);

        // setTimeout(() => {
        //   MBLsheet.destroy();
        //   MBLsheet.init(
        //     { container: "mblsheet" },
        //     {
        //       columns: columns,
        //       dataSource: excelDataSource,
        //       row: 20,
        //     }
        //   );
        // }, 5000);

        // const ranges = MBLsheet.getRange();
        // console.log("%c Line:132 🥝 ranges", "color:#e41a6a", ranges);
        // MBLsheet.create({
        //   container: "mblsheet",
        //   lang: "zh",
        //   data: [sgCell],
        // });
      });
    </script>
    <style>
      /* 自定义loading演示样式 */
      @keyframes loading-rotate {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }

      @keyframes loading-dash {
        0% {
          stroke-dasharray: 1, 200;
          stroke-dashoffset: 0;
        }

        50% {
          stroke-dasharray: 90, 150;
          stroke-dashoffset: -40px;
        }

        100% {
          stroke-dasharray: 90, 150;
          stroke-dashoffset: -120px;
        }
      }

      .loadingAnimation {
        width: 3em;
        height: 3em;
        animation: loading-rotate 2s linear infinite;
      }

      .loadingAnimation circle {
        animation: loading-dash 1.5s ease-in-out infinite;
        stroke-dasharray: 90, 150;
        stroke-dashoffset: 0;
        stroke-width: 2;
        stroke: currentColor;
        stroke-linecap: round;
      }
    </style>

    <!-- <script>
      const cvs = document.getElementById("ctx");
      const ctx = cvs.getContext("2d");

      ctx.beginPath();

      // 左上起点
      ctx.moveTo(50, 100);
      // 右上 向右移动
      ctx.lineTo(100, 100);
      // 右下 向下移动
      ctx.lineTo(100, 150);
      // 左下 向左移动
      ctx.lineTo(50, 150);
      // 左上 回到起点
      ctx.lineTo(50, 100);
      ctx.fillStyle = "#FC6666";
      ctx.fill();
      ctx.closePath();
    </script> -->
  </body>
</html>
